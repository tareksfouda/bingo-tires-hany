(function(a){a.fn.iv_googlemap=function(b){return this.each(function(){new a.iv.googlemap(this,b)})};a.fn.iv_googlemap_set_map=function(b,c){return this.each(function(){var d=a.data(this,"googlemap");d.set_map(b,c)})};a.fn.iv_googlemap_to_here=function(){return this.each(function(){var b=a.data(this,"googlemap");b.to_here()})};a.fn.iv_googlemap_from_here=function(){return this.each(function(){var b=a.data(this,"googlemap");b.from_here()})};a.iv.googlemap=function(b,m){m=a.extend({zoom:3,address_text:"Address",directions_text:"Get directions",start_address:"Start address",end_address:"End address",to_here_text:"To here",from_here_text:"From here",go_text:"Go",no_directions:null,is_responsive:null},m);var l=a(b);var g=l.attr("lat");var i=l.attr("long");m.zoom=parseInt(l.attr("zoom"));a.data(b,"googlemap",this);h();function h(){var n=JSON.parse(decodeURIComponent(l.attr("values")));j(n)}function j(p,t){var o=p.address;var q=p.width;var n=p.height;var s=parseInt(p.zoom);if((a.iv.editor&&a.iv.editor.is_responsive)||m.is_responsive){l.width("100%")}else{if(q){l.width(parseInt(q))}}if(n){l.height(parseInt(n))}var r;if(p.error){r=p.error+"<br />"+o}else{r=e(o)}var u={map:{options:{zoom:s,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}}},marker:{events:{click:function(){var w=l.gmap3({get:{id:l.attr("id")+"_infowindow"}});w.close();var v={infowindow:{address:o,id:l.attr("id")+"_infowindow",options:{content:r}}};if(t){u.infowindow.address=o}else{u.infowindow.latLng=[g,i]}l.gmap3(v)}}},infowindow:{id:l.attr("id")+"_infowindow",options:{content:r}}};if(t){u.map.options.address=o;u.marker.address=o;u.infowindow.address=o}else{u.map.options.center=[g,i];u.marker.latLng=[g,i];u.infowindow.latLng=[g,i]}l.gmap3(u);setTimeout(function(){google.maps.event.trigger(l.gmap3("get"),"resize")},100)}function f(o,r){if(r==null){r=1}for(var p in o){l.attr(p,o[p])}var q=parseInt(o.zoom);var n=o.address;l.attr({values:encodeURIComponent(JSON.stringify(o)),zoom:q});l.gmap3("destroy");j(o,r)}function e(n){var o="<div class='address_text'>"+m.address_text+":</div><div>"+n+"</div>";if(m.no_directions){}var q="onclick=\"$('#"+l.attr("id")+"').iv_googlemap_to_here();\"";var p="onclick=\"$('#"+l.attr("id")+"').iv_googlemap_from_here();\"";o+='<div class="directions_text">'+m.directions_text+': <span id="to_here" '+q+">"+m.to_here_text+'</span> - <span id="from_here" '+p+">"+m.from_here_text+"</span></div>";return o}function d(){var o=l.gmap3({get:{id:l.attr("id")+"_infowindow"}});var v=JSON.parse(decodeURIComponent(l.attr("values")));var u=v.address;var p=e(u);var n=a("<form></form>");n.attr("action","http://maps.google.com/maps");n.attr("target","google_maps");n.attr("method","get");var w=a('<input type="hidden"></input>');w.attr("name","daddr");w.val(u);var s=a('<input type="text"></input>');s.attr("name","saddr");var t=a("<div>Start address</div>");t.addClass("directions_start_address");var q=a('<input type="submit" value="Go"></input>');n.append(t);n.append(w);n.append(s);n.append(q);var r=a("<div></div>").append(n);p+=r.html();o.setContent(p)}function k(){var p=l.gmap3({get:{id:l.attr("id")+"_infowindow"}});var v=JSON.parse(decodeURIComponent(l.attr("values")));var u=v.address;var q=e(u);var o=a("<form></form>");o.attr("action","http://maps.google.com/maps");o.attr("target","google_maps");o.attr("method","get");var t=a('<input type="hidden"></input>');t.attr("name","saddr");t.val(u);var w=a('<input type="text"></input>');w.attr("name","daddr");var n=a("<div>End address</div>");n.addClass("directions_end_address");var r=a('<input type="submit" value="Go"></input>');o.append(n);o.append(w);o.append(t);o.append(r);var s=a("<div></div>").append(o);q+=s.html();p.setContent(q)}function c(o,p){var q=o.geo_country_id;var n="";if(q){if(q==1||q==2||q==3){n=o.address1;if(o.address2){n+="<br />"+o.address2}n+="<br />"+o.geo_subregion+", "+o.geo_region+", "+o.postal_code}else{if(q==4){if(o.geo_region){n=o.geo_region+", "}if(o.geo_subregion){n+=o.geo_subregion+"<br />"}n+=o.address1;if(o.address2){n+=" "+o.address2}if(o.postal_code){n+=" "+o.postal_code}}else{if(q==5){if(o.geo_region){n=o.geo_region+", "}if(o.geo_subregion){n+=o.geo_subregion+"<br />"}n+=o.address1;if(o.address2){n+=" "+o.address2}}else{n=o.address1;if(o.address2){n+="<br />"+o.address2}n+="<br />"+o.geo_subregion+", "+o.geo_region+", "+o.postal_code}}}if(p){n=n.replace(/<br \/>/gi,", ")}return n}else{return o.display_address}}this.set_map=f;this.to_here=d;this.from_here=k}})(jQuery);